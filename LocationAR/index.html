<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>AR.js with Real-Time Location + 1 Meter</title>

    <!-- A-Frame and AR.js Libraries -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; location: true;">
        
        <!-- Marqueur avec un ID pour pouvoir manipuler ses coordonnées -->
        <a-marker type="location" id="location-marker">
            <!-- Modèle 3D (cube rouge) -->
            <a-box position="0 0.5 0" material="color: red;" scale="0.5 0.5 0.5"></a-box>
        </a-marker>

        <!-- Caméra AR -->
        <a-entity camera></a-entity>

    </a-scene>

    <script>
        // Fonction pour obtenir la localisation via JavaScript
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(function(position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    // Afficher la position dans la console pour le débogage
                    console.log("Latitude: " + latitude + ", Longitude: " + longitude);

                    // Trouver le marqueur dans la scène AR
                    var marker = document.querySelector('#location-marker');

                    // Déplacer le marqueur AR 1 mètre devant la position GPS
                    // Pour simplifier, nous allons juste ajuster la position
                    // en supposant que vous vous déplacez le long de l'axe Z de la scène (distance de 1m devant).

                    // Ajouter 1 mètre à la position actuelle
                    var newLatitude = latitude + 0.000009  // approx. 1 meter in latitude
                    var newLongitude = longitude + 0.000009  // approx. 1 meter in longitude

                    // Mettre à jour la position du marqueur avec les nouvelles coordonnées
                    marker.setAttribute('latitude', newLatitude);
                    marker.setAttribute('longitude', newLongitude);
                }, function(error) {
                    console.error("Erreur de géolocalisation: " + error.message);
                }, {
                    enableHighAccuracy: true,  // Activer une géolocalisation plus précise
                    maximumAge: 1000,          // Temps maximum avant de récupérer une nouvelle position
                    timeout: 5000              // Temps d'attente avant d'abandonner si pas de position
                });
            } else {
                alert("La géolocalisation n'est pas supportée par votre navigateur.");
            }
        }

        // Lorsque la page est chargée, obtenir la localisation
        window.onload = function() {
            getLocation();
        };
    </script>

</body>
</html>
